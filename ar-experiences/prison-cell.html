<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Out Of Reach - Prison Cell Experience</title>

  <!-- A-Frame Library -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    /* Camera feed background */
    #camera-feed {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }

    /* A-Frame canvas on top */
    .a-canvas {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      z-index: 2 !important;
    }

    /* Permission Overlay */
    #permissionOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 50%, #16213e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: white;
    }

    #permissionMessage {
      text-align: center;
      padding: 40px;
      max-width: 500px;
      animation: fadeIn 1s ease-in;
    }

    #permissionMessage h2 {
      font-size: 2.5em;
      margin-bottom: 15px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    #permissionMessage .subtitle {
      font-size: 0.9em;
      margin-bottom: 30px;
      opacity: 0.7;
      font-style: italic;
    }

    #permissionMessage p {
      font-size: 1.1em;
      margin-bottom: 35px;
      opacity: 0.9;
      line-height: 1.6;
    }

    #startButton {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 18px 45px;
      font-size: 1.1em;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #startButton:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
    }

    #startButton:active {
      transform: translateY(0);
    }

    /* Instructions overlay */
    .instructions {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 13px;
      text-align: center;
      z-index: 1000;
      backdrop-filter: blur(10px);
      max-width: 80%;
      pointer-events: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Camera Feed Background -->
  <video id="camera-feed" autoplay playsinline></video>

  <!-- Permission Request Overlay -->
  <div id="permissionOverlay">
    <div id="permissionMessage">
      <h2>Out Of Reach</h2>
      <p class="subtitle">A Prison Cell Sky Experience</p>
      <p>Look up at the ceiling to break through the boundaries of this space and explore the cosmos beyond.</p>
      <button id="startButton">Begin Journey</button>
    </div>
  </div>

  <!-- Instructions -->
  <div class="instructions hidden" id="instructions">
    Point your phone up at the ceiling
  </div>

  <!-- A-Frame Scene -->
  <a-scene
    renderer="colorManagement: true; antialias: true; alpha: true"
    background="transparent"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <img id="skyTexture" src="../assets/space.png" crossorigin="anonymous">
      <img id="cubeTexture" src="https://cdn.8thwall.com/web/assets/cube-texture.png" crossorigin="anonymous">
    </a-assets>

    <!-- Camera with look controls -->
    <a-camera
      position="0 0 0"
      look-controls="enabled: true; touchEnabled: true"
      wasd-controls="enabled: false">
    </a-camera>

    <!-- Sky container - only visible when looking up -->
    <a-entity id="sky-container">

      <!-- Full sky sphere -->
      <a-sky
        id="space-sky"
        src="#skyTexture"
        rotation="0 0 0"
        material="fog: false; opacity: 0"
        class="sky-element">
      </a-sky>

      <!-- Floating Purple Box - "Out Of Reach" -->
      <a-box
        position="0 15 -15"
        scale="5 5 5"
        rotation="0 45 0"
        material="color: #AD50FF; src: #cubeTexture; metalness: 0.3; roughness: 0.7; opacity: 0"
        animation="property: rotation; to: 0 405 0; loop: true; dur: 10000; easing: linear"
        animation__float="property: position; to: 0 17 -15; dir: alternate; loop: true; dur: 4000; easing: easeInOutSine"
        class="sky-element">
      </a-box>

      <!-- Additional floating sphere -->
      <a-sphere
        position="10 18 -20"
        radius="2.5"
        material="color: #4CC3D9; metalness: 0.5; roughness: 0.5; opacity: 0"
        animation="property: rotation; to: 360 360 0; loop: true; dur: 20000; easing: linear"
        animation__float="property: position; to: 10 16 -20; dir: alternate; loop: true; dur: 5000; easing: easeInOutSine"
        class="sky-element">
      </a-sphere>

      <!-- Additional floating cylinder -->
      <a-cylinder
        position="-8 20 -25"
        radius="1.5"
        height="4"
        material="color: #FFC65D; metalness: 0.4; roughness: 0.6; opacity: 0"
        rotation="45 0 45"
        animation="property: rotation; to: 405 360 405; loop: true; dur: 15000; easing: linear"
        animation__float="property: position; to: -8 18 -25; dir: alternate; loop: true; dur: 6000; easing: easeInOutSine"
        class="sky-element">
      </a-cylinder>

      <!-- Ambient Light -->
      <a-entity light="type: ambient; intensity: 0.8"></a-entity>

      <!-- Directional Light -->
      <a-entity light="type: directional; intensity: 0.6" position="1 1 0"></a-entity>

      <!-- Point lights for atmosphere -->
      <a-entity light="type: point; intensity: 0.5; color: #AD50FF" position="0 15 -15"></a-entity>
      <a-entity light="type: point; intensity: 0.3; color: #4CC3D9" position="10 18 -20"></a-entity>

    </a-entity>

  </a-scene>

  <script>
    // Out Of Reach - Gyroscope-based sky effect
    const permissionOverlay = document.getElementById('permissionOverlay');
    const startButton = document.getElementById('startButton');
    const instructions = document.getElementById('instructions');
    const cameraFeed = document.getElementById('camera-feed');

    let deviceOrientationGranted = false;
    let skyVisible = false;

    // Start camera feed
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          }
        });
        cameraFeed.srcObject = stream;
        console.log('Camera feed started');
      } catch (error) {
        console.error('Error accessing camera:', error);
        alert('Camera access is required for this AR experience.');
      }
    }

    // Request device orientation permissions (iOS 13+)
    async function requestPermissions() {
      try {
        // Request camera permission
        await startCamera();

        // Request device orientation permission (iOS 13+)
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
          const permission = await DeviceOrientationEvent.requestPermission();

          if (permission === 'granted') {
            deviceOrientationGranted = true;
            startExperience();
          } else {
            alert('Device orientation permission is required for this experience.');
          }
        } else {
          // Android or older iOS - no permission needed
          deviceOrientationGranted = true;
          startExperience();
        }
      } catch (error) {
        console.error('Error requesting permissions:', error);
        startExperience();
      }
    }

    // Start the AR experience
    function startExperience() {
      permissionOverlay.classList.add('hidden');
      instructions.classList.remove('hidden');

      // Listen to device orientation
      window.addEventListener('deviceorientation', handleOrientation);

      console.log('Out Of Reach - Gyroscope tracking started');
    }

    // Handle device orientation
    function handleOrientation(event) {
      // Beta is the front-to-back tilt in degrees
      // When phone points up: beta is negative (around -60 to -90)
      // When phone is level: beta is around 0
      // When phone points down: beta is positive

      const beta = event.beta; // -180 to 180
      const gamma = event.gamma; // -90 to 90

      // Get all sky elements
      const skyElements = document.querySelectorAll('.sky-element');

      // Show sky effect when phone tilts up (beta < -30 means looking up)
      if (beta < -30) {
        // Looking up at ceiling
        if (!skyVisible) {
          skyVisible = true;
          instructions.textContent = 'âœ¨ Look around the cosmos';
          instructions.style.background = 'rgba(76, 195, 217, 0.8)';

          // Fade in sky elements
          skyElements.forEach(el => {
            el.setAttribute('material', 'opacity', 1);
          });
        }
      } else {
        // Looking at walls or floor
        if (skyVisible) {
          skyVisible = false;
          instructions.textContent = 'Point your phone up at the ceiling';
          instructions.style.background = 'rgba(0, 0, 0, 0.7)';

          // Fade out sky elements
          skyElements.forEach(el => {
            const currentMaterial = el.getAttribute('material');
            if (currentMaterial) {
              el.setAttribute('material', 'opacity', 0);
            }
          });
        }
      }
    }

    // Start button click handler
    startButton.addEventListener('click', requestPermissions);

    // Prevent body scroll on mobile
    document.body.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
